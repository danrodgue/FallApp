# ğŸ“± Arquitectura de Aplicaciones MÃ³viles - FallApp

> **Spec ID**: MOBILE-000  
> **VersiÃ³n**: 1.0  
> **Estado**: ğŸ”„ En Desarrollo  
> **Fecha**: 2026-02-01  
> **Autor**: Equipo FallApp

---

## ğŸ“‹ Ãndice

1. [VisiÃ³n General](#1-visiÃ³n-general)
2. [Aplicaciones del Ecosistema](#2-aplicaciones-del-ecosistema)
3. [Arquitectura Clean Architecture](#3-arquitectura-clean-architecture)
4. [Estructura de MÃ³dulos](#4-estructura-de-mÃ³dulos)
5. [Stack TecnolÃ³gico](#5-stack-tecnolÃ³gico)
6. [ConfiguraciÃ³n Global](#6-configuraciÃ³n-global)
7. [Patrones y Convenciones](#7-patrones-y-convenciones)
8. [Flujo de Datos](#8-flujo-de-datos)

---

## 1. VisiÃ³n General

### 1.1 Objetivo
Desarrollar aplicaciones Android nativas utilizando **Clean Architecture**, **Jetpack Compose** y **Kotlin** para consumir la API REST de FallApp y proporcionar funcionalidades offline-first.

### 1.2 Principios Rectores

| Principio | DescripciÃ³n |
|-----------|-------------|
| **Spec-Driven Development** | Todo cÃ³digo nace de una especificaciÃ³n documentada |
| **Clean Architecture** | SeparaciÃ³n estricta de capas con dependencias hacia adentro |
| **Offline-First** | Los datos se cachean localmente con Room |
| **Modular por Features** | Cada funcionalidad es un mÃ³dulo independiente |
| **Testable** | Arquitectura diseÃ±ada para facilitar pruebas |

### 1.3 Diagrama General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APLICACIONES MÃ“VILES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       FallApp Admin             â”‚         FallApp User               â”‚
â”‚    (Monitoreo + Testing)        â”‚    (Usuarios Finales)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Estado del servidor    â”‚   â”‚   â”‚ â€¢ Mapa de fallas         â”‚    â”‚
â”‚  â”‚ â€¢ Tests de API           â”‚   â”‚   â”‚ â€¢ VotaciÃ³n de ninots     â”‚    â”‚
â”‚  â”‚ â€¢ Logs y mÃ©tricas        â”‚   â”‚   â”‚ â€¢ Eventos de casales     â”‚    â”‚
â”‚  â”‚ â€¢ GestiÃ³n de errores     â”‚   â”‚   â”‚ â€¢ Perfil de usuario      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTPS / REST
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API REST (Spring Boot)                       â”‚
â”‚                      http://35.180.21.42:8080                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Aplicaciones del Ecosistema

### 2.1 FallApp Admin (Monitoreo y Testing)

**Package**: `com.fallapp.admin`  
**Objetivo**: Herramienta para administradores del sistema

**Funcionalidades**:
- ğŸ” Monitor de estado del servidor (health check)
- ğŸ§ª Suite de tests API ejecutables desde el mÃ³vil
- ğŸ“Š Dashboard de mÃ©tricas y estadÃ­sticas
- ğŸ“ Visor de logs de la API
- âš ï¸ Alertas y notificaciones de errores
- ğŸ‘¥ GestiÃ³n rÃ¡pida de usuarios (ban, roles)

### 2.2 FallApp User (AplicaciÃ³n de Usuario)

**Package**: `com.fallapp.user`  
**Objetivo**: AplicaciÃ³n principal para usuarios finales

**Funcionalidades**:
- ğŸ—ºï¸ Mapa interactivo con fallas geolocalizadas
- ğŸ† VotaciÃ³n de ninots (Ingenioso, CrÃ­tico, ArtÃ­stico)
- ğŸ“… Calendario de eventos de casales
- â­ Favoritos y seguimiento de fallas
- ğŸ” BÃºsqueda y filtrado avanzado
- ğŸ‘¤ GestiÃ³n de perfil de usuario
- ğŸ’¬ Comentarios en fallas y ninots
- ğŸ”” Notificaciones de eventos prÃ³ximos

---

## 3. Arquitectura Clean Architecture

### 3.1 Capas y Responsabilidades

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRESENTATION LAYER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  UI (Jetpack Compose)                                  â”‚  â”‚
â”‚  â”‚  â€¢ Screens / Composables                               â”‚  â”‚
â”‚  â”‚  â€¢ UI State / UI Events                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ViewModels                                            â”‚  â”‚
â”‚  â”‚  â€¢ GestiÃ³n de estado (StateFlow)                       â”‚  â”‚
â”‚  â”‚  â€¢ Manejo de eventos de UI                             â”‚  â”‚
â”‚  â”‚  â€¢ Llamadas a UseCases                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ depende de
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DOMAIN LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Use Cases / Interactors                               â”‚  â”‚
â”‚  â”‚  â€¢ Una clase = Una acciÃ³n de negocio                   â”‚  â”‚
â”‚  â”‚  â€¢ GetFallasUseCase, VotarNinotUseCase, etc.           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Domain Models (Entities)                              â”‚  â”‚
â”‚  â”‚  â€¢ Modelos puros de negocio                            â”‚  â”‚
â”‚  â”‚  â€¢ Sin dependencias de frameworks                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Repository Interfaces                                 â”‚  â”‚
â”‚  â”‚  â€¢ Contratos para acceso a datos                       â”‚  â”‚
â”‚  â”‚  â€¢ Definidos aquÃ­, implementados en Data               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ implementa
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Repository Implementations                            â”‚  â”‚
â”‚  â”‚  â€¢ FallaRepositoryImpl, EventoRepositoryImpl           â”‚  â”‚
â”‚  â”‚  â€¢ LÃ³gica offline-first                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Remote Data Source     â”‚  â”‚   Local Data Source       â”‚  â”‚
â”‚  â”‚  â€¢ Ktor Client          â”‚  â”‚   â€¢ Room Database         â”‚  â”‚
â”‚  â”‚  â€¢ API Service          â”‚  â”‚   â€¢ DAOs                  â”‚  â”‚
â”‚  â”‚  â€¢ DTOs de red          â”‚  â”‚   â€¢ Entities de BD        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Mappers                                               â”‚  â”‚
â”‚  â”‚  â€¢ NetworkDTO â†’ DomainModel                            â”‚  â”‚
â”‚  â”‚  â€¢ DomainModel â†’ RoomEntity                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Regla de Dependencias

```
âœ… PERMITIDO:
   Presentation â†’ Domain
   Data â†’ Domain
   
âŒ PROHIBIDO:
   Domain â†’ Presentation
   Domain â†’ Data
   Presentation â†’ Data (directamente)
```

---

## 4. Estructura de MÃ³dulos

### 4.1 Estructura de Paquetes (Por Feature)

```
com.fallapp.user/
â”œâ”€â”€ core/                          # NÃºcleo compartido
â”‚   â”œâ”€â”€ config/                    # ConfiguraciÃ³n global
â”‚   â”‚   â””â”€â”€ ApiConfig.kt           # URL base, timeouts
â”‚   â”œâ”€â”€ di/                        # InyecciÃ³n de dependencias
â”‚   â”‚   â””â”€â”€ AppModule.kt
â”‚   â”œâ”€â”€ network/                   # Cliente HTTP configurado
â”‚   â”‚   â”œâ”€â”€ KtorClient.kt
â”‚   â”‚   â””â”€â”€ AuthInterceptor.kt
â”‚   â”œâ”€â”€ database/                  # Room Database
â”‚   â”‚   â””â”€â”€ FallAppDatabase.kt
â”‚   â””â”€â”€ util/                      # Utilidades comunes
â”‚       â”œâ”€â”€ Result.kt              # Wrapper para resultados
â”‚       â””â”€â”€ Extensions.kt
â”‚
â”œâ”€â”€ features/                      # Features organizadas por dominio
â”‚   â”œâ”€â”€ auth/                      # Feature: AutenticaciÃ³n
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthApiService.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ LoginRequestDto.kt
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ LoginResponseDto.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthLocalDataSource.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TokenManager.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthMapper.kt
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ AuthRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ User.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthToken.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ LogoutUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ login/
â”‚   â”‚       â”‚   â”œâ”€â”€ LoginScreen.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ LoginViewModel.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ LoginUiState.kt
â”‚   â”‚       â”‚   â””â”€â”€ LoginUiEvent.kt
â”‚   â”‚       â””â”€â”€ register/
â”‚   â”‚           â”œâ”€â”€ RegisterScreen.kt
â”‚   â”‚           â””â”€â”€ RegisterViewModel.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ fallas/                    # Feature: Fallas
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaApiService.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaDao.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FallaEntity.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Falla.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FallaRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ GetFallasUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ GetFallaByIdUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ SearchFallasUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ GetFallasCercanasUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ list/
â”‚   â”‚       â”œâ”€â”€ detail/
â”‚   â”‚       â””â”€â”€ map/
â”‚   â”‚
â”‚   â”œâ”€â”€ eventos/                   # Feature: Eventos
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚
â”‚   â”œâ”€â”€ ninots/                    # Feature: Ninots y VotaciÃ³n
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚
â”‚   â””â”€â”€ profile/                   # Feature: Perfil de Usuario
â”‚       â”œâ”€â”€ data/
â”‚       â”œâ”€â”€ domain/
â”‚       â””â”€â”€ presentation/
â”‚
â””â”€â”€ navigation/                    # NavegaciÃ³n global
    â”œâ”€â”€ NavGraph.kt
    â””â”€â”€ Routes.kt
```

---

## 5. Stack TecnolÃ³gico

### 5.1 Dependencias Principales

| CategorÃ­a | LibrerÃ­a | VersiÃ³n | PropÃ³sito |
|-----------|----------|---------|-----------|
| **UI** | Jetpack Compose | BOM 2024.x | UI declarativa |
| **UI** | Material 3 | 1.2.x | Design system |
| **Arquitectura** | ViewModel | 2.7.x | GestiÃ³n de estado |
| **Networking** | Ktor Client | 2.3.x | Cliente HTTP |
| **SerializaciÃ³n** | Kotlinx Serialization | 1.6.x | JSON parsing |
| **Base de Datos** | Room | 2.6.x | Persistencia local |
| **DI** | Koin | 3.5.x | InyecciÃ³n de dependencias |
| **Async** | Coroutines | 1.8.x | ProgramaciÃ³n asÃ­ncrona |
| **Mapas** | Google Maps Compose | 4.x | Mapas interactivos |
| **ImÃ¡genes** | Coil | 2.5.x | Carga de imÃ¡genes |
| **Navigation** | Compose Navigation | 2.7.x | NavegaciÃ³n entre pantallas |

### 5.2 ConfiguraciÃ³n Gradle (libs.versions.toml)

```toml
[versions]
kotlin = "1.9.22"
compose-bom = "2024.02.00"
ktor = "2.3.7"
room = "2.6.1"
koin = "3.5.3"
coroutines = "1.8.0"

[libraries]
# Ktor Client
ktor-client-core = { module = "io.ktor:ktor-client-core", version.ref = "ktor" }
ktor-client-android = { module = "io.ktor:ktor-client-android", version.ref = "ktor" }
ktor-client-content-negotiation = { module = "io.ktor:ktor-client-content-negotiation", version.ref = "ktor" }
ktor-serialization-json = { module = "io.ktor:ktor-serialization-kotlinx-json", version.ref = "ktor" }
ktor-client-logging = { module = "io.ktor:ktor-client-logging", version.ref = "ktor" }
ktor-client-auth = { module = "io.ktor:ktor-client-auth", version.ref = "ktor" }

# Room
room-runtime = { module = "androidx.room:room-runtime", version.ref = "room" }
room-ktx = { module = "androidx.room:room-ktx", version.ref = "room" }
room-compiler = { module = "androidx.room:room-compiler", version.ref = "room" }

# Koin
koin-android = { module = "io.insert-koin:koin-android", version.ref = "koin" }
koin-compose = { module = "io.insert-koin:koin-androidx-compose", version.ref = "koin" }
```

---

## 6. ConfiguraciÃ³n Global

### 6.1 ApiConfig.kt - ConfiguraciÃ³n Centralizada

```kotlin
// core/config/ApiConfig.kt
package com.fallapp.core.config

object ApiConfig {
    /**
     * URL base de la API REST.
     * IMPORTANTE: Cambiar esta URL cuando cambie la IP del servidor AWS.
     * 
     * Desarrollo: http://35.180.21.42:8080
     * ProducciÃ³n: https://api.fallapp.es (futuro)
     */
    const val BASE_URL = "http://35.180.21.42:8080"
    
    // Endpoints base
    const val API_PATH = "/api"
    
    // Timeouts (en milisegundos)
    const val CONNECT_TIMEOUT = 30_000L
    const val READ_TIMEOUT = 30_000L
    const val WRITE_TIMEOUT = 30_000L
    
    // ConfiguraciÃ³n JWT
    const val TOKEN_PREFIX = "Bearer "
    const val TOKEN_EXPIRATION_HOURS = 24
    
    // PaginaciÃ³n por defecto
    const val DEFAULT_PAGE_SIZE = 20
    const val MAX_PAGE_SIZE = 100
    
    // Endpoints especÃ­ficos
    object Endpoints {
        // Auth
        const val LOGIN = "$API_PATH/auth/login"
        const val REGISTER = "$API_PATH/auth/registro"
        
        // Fallas
        const val FALLAS = "$API_PATH/fallas"
        const val FALLAS_BUSCAR = "$API_PATH/fallas/buscar"
        const val FALLAS_CERCANAS = "$API_PATH/fallas/cercanas"
        
        // Eventos
        const val EVENTOS = "$API_PATH/eventos"
        const val EVENTOS_FUTUROS = "$API_PATH/eventos/futuros"
        const val EVENTOS_PROXIMOS = "$API_PATH/eventos/proximos"
        
        // Ninots
        const val NINOTS = "$API_PATH/ninots"
        const val NINOTS_PREMIADOS = "$API_PATH/ninots/premiados"
        
        // Votos
        const val VOTOS = "$API_PATH/votos"
        
        // Comentarios
        const val COMENTARIOS = "$API_PATH/comentarios"
        
        // Admin
        const val HEALTH = "/actuator/health"
        const val METRICS = "/actuator/metrics"
    }
}
```

### 6.2 Result Wrapper

```kotlin
// core/util/Result.kt
package com.fallapp.core.util

/**
 * Wrapper para resultados de operaciones que pueden fallar.
 * Usado en toda la aplicaciÃ³n para manejo consistente de errores.
 */
sealed class Result<out T> {
    data class Success<T>(val data: T) : Result<T>()
    data class Error(val exception: Throwable, val message: String? = null) : Result<Nothing>()
    data object Loading : Result<Nothing>()
    
    val isSuccess: Boolean get() = this is Success
    val isError: Boolean get() = this is Error
    val isLoading: Boolean get() = this is Loading
    
    fun getOrNull(): T? = (this as? Success)?.data
    
    fun getOrThrow(): T = when (this) {
        is Success -> data
        is Error -> throw exception
        is Loading -> throw IllegalStateException("Result is still loading")
    }
    
    inline fun <R> map(transform: (T) -> R): Result<R> = when (this) {
        is Success -> Success(transform(data))
        is Error -> this
        is Loading -> this
    }
    
    inline fun onSuccess(action: (T) -> Unit): Result<T> {
        if (this is Success) action(data)
        return this
    }
    
    inline fun onError(action: (Throwable, String?) -> Unit): Result<T> {
        if (this is Error) action(exception, message)
        return this
    }
}
```

---

## 7. Patrones y Convenciones

### 7.1 PatrÃ³n MVI para UI

```kotlin
// Estado de UI (inmutable)
data class FallasUiState(
    val fallas: List<Falla> = emptyList(),
    val isLoading: Boolean = false,
    val error: String? = null,
    val searchQuery: String = ""
)

// Eventos de UI (acciones del usuario)
sealed class FallasUiEvent {
    data class SearchQueryChanged(val query: String) : FallasUiEvent()
    data class FallaClicked(val fallaId: Long) : FallasUiEvent()
    data object RefreshClicked : FallasUiEvent()
    data object RetryClicked : FallasUiEvent()
}

// Efectos laterales (navegaciÃ³n, snackbars, etc.)
sealed class FallasEffect {
    data class NavigateToDetail(val fallaId: Long) : FallasEffect()
    data class ShowSnackbar(val message: String) : FallasEffect()
}
```

### 7.2 ViewModel Base

```kotlin
// PatrÃ³n base para todos los ViewModels
abstract class BaseViewModel<State, Event, Effect> : ViewModel() {
    
    private val _uiState = MutableStateFlow(initialState())
    val uiState: StateFlow<State> = _uiState.asStateFlow()
    
    private val _effects = Channel<Effect>(Channel.BUFFERED)
    val effects: Flow<Effect> = _effects.receiveAsFlow()
    
    abstract fun initialState(): State
    abstract fun handleEvent(event: Event)
    
    protected fun updateState(reducer: State.() -> State) {
        _uiState.update { it.reducer() }
    }
    
    protected fun sendEffect(effect: Effect) {
        viewModelScope.launch {
            _effects.send(effect)
        }
    }
}
```

### 7.3 Convenciones de Nombrado

| Tipo | ConvenciÃ³n | Ejemplo |
|------|------------|---------|
| **Use Case** | `{Verbo}{Sustantivo}UseCase` | `GetFallasUseCase`, `VotarNinotUseCase` |
| **Repository** | `{Entidad}Repository` | `FallaRepository`, `EventoRepository` |
| **ViewModel** | `{Pantalla}ViewModel` | `FallasListViewModel`, `LoginViewModel` |
| **Screen** | `{Nombre}Screen` | `FallasListScreen`, `LoginScreen` |
| **UiState** | `{Feature}UiState` | `FallasUiState`, `AuthUiState` |
| **DTO** | `{Entidad}{Tipo}Dto` | `FallaResponseDto`, `LoginRequestDto` |
| **Entity (Room)** | `{Entidad}Entity` | `FallaEntity`, `UserEntity` |
| **Mapper** | `{Entidad}Mapper` | `FallaMapper`, `UserMapper` |

---

## 8. Flujo de Datos

### 8.1 Flujo Offline-First

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Screen    â”‚ â”€â”€â–º â”‚  ViewModel  â”‚ â”€â”€â–º â”‚   UseCase   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â–²                                        â”‚
      â”‚                                        â–¼
      â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                               â”‚   Repository    â”‚
      â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                        â”‚
      â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚              â–¼                         â–¼                         â”‚
      â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
      â”‚     â”‚   Room (Local)  â”‚       â”‚   Ktor (Remote) â”‚               â”‚
      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚              â”‚                         â”‚                         â”‚
      â”‚              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
      â”‚              â”‚    â”‚                                              â”‚
      â”‚              â–¼    â–¼                                              â”‚
      â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Flow<Data>     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Estrategia:
1. Emitir datos locales (cachÃ©) inmediatamente
2. Solicitar datos remotos en paralelo
3. Actualizar cachÃ© local con datos remotos
4. Emitir datos actualizados automÃ¡ticamente
```

### 8.2 Ejemplo de ImplementaciÃ³n Repository

```kotlin
class FallaRepositoryImpl(
    private val remoteDataSource: FallaRemoteDataSource,
    private val localDataSource: FallaLocalDataSource,
    private val mapper: FallaMapper
) : FallaRepository {

    override fun getFallas(): Flow<Result<List<Falla>>> = flow {
        emit(Result.Loading)
        
        // 1. Emitir datos locales primero
        val localFallas = localDataSource.getAllFallas()
        if (localFallas.isNotEmpty()) {
            emit(Result.Success(localFallas.map { mapper.entityToDomain(it) }))
        }
        
        // 2. Intentar obtener datos remotos
        try {
            val remoteFallas = remoteDataSource.getFallas()
            
            // 3. Guardar en cachÃ© local
            localDataSource.insertAll(remoteFallas.map { mapper.dtoToEntity(it) })
            
            // 4. Emitir datos actualizados
            emit(Result.Success(remoteFallas.map { mapper.dtoToDomain(it) }))
        } catch (e: Exception) {
            // Si hay datos locales, ya se emitieron; si no, emitir error
            if (localFallas.isEmpty()) {
                emit(Result.Error(e, "Error al cargar fallas"))
            }
        }
    }.flowOn(Dispatchers.IO)
}
```

---

## ğŸ“š Documentos Relacionados

- [01.APP-ADMIN-SPEC.md](01.APP-ADMIN-SPEC.md) - EspecificaciÃ³n de la app de administraciÃ³n
- [02.APP-USER-SPEC.md](02.APP-USER-SPEC.md) - EspecificaciÃ³n de la app de usuario
- [03.PROMPT-GENERACION-IA.md](03.PROMPT-GENERACION-IA.md) - Prompts para generaciÃ³n de cÃ³digo con IA
- [04.PLANTILLA-ERRORES.md](04.PLANTILLA-ERRORES.md) - Plantilla para documentar errores y soluciones
- [../GUIA.API.FRONTEND.md](../GUIA.API.FRONTEND.md) - DocumentaciÃ³n completa de la API

---

> **Siguiente paso**: Leer las especificaciones de cada aplicaciÃ³n para implementar las features.
