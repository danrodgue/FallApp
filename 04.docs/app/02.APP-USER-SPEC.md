# ğŸ“± FallApp User - EspecificaciÃ³n de AplicaciÃ³n

> **Spec ID**: MOBILE-002  
> **VersiÃ³n**: 1.0  
> **Estado**: ğŸ”„ En Desarrollo  
> **Fecha**: 2026-02-01  
> **Package**: `com.fallapp.user`

---

## ğŸ“‹ Ãndice

1. [Objetivo de la AplicaciÃ³n](#1-objetivo-de-la-aplicaciÃ³n)
2. [Funcionalidades](#2-funcionalidades)
3. [Arquitectura de Features](#3-arquitectura-de-features)
4. [Pantallas y NavegaciÃ³n](#4-pantallas-y-navegaciÃ³n)
5. [Modelos de Dominio](#5-modelos-de-dominio)
6. [API Endpoints Utilizados](#6-api-endpoints-utilizados)
7. [Estrategia Offline-First](#7-estrategia-offline-first)
8. [Mapas y GeolocalizaciÃ³n](#8-mapas-y-geolocalizaciÃ³n)

---

## 1. Objetivo de la AplicaciÃ³n

### 1.1 DescripciÃ³n General

**FallApp User** es la aplicaciÃ³n principal para usuarios finales que desean explorar las fallas valencianas, votar ninots, consultar eventos y participar en la comunidad fallera.

### 1.2 Usuarios Objetivo

| Rol | Acceso | Funcionalidades |
|-----|--------|-----------------|
| **USUARIO** | âœ… Completo | Ver fallas, votar, comentar, favoritos |
| **CASAL** | âœ… Completo + GestiÃ³n | Todo de usuario + editar su falla |
| **AnÃ³nimo** | ğŸ”“ Parcial | Solo visualizaciÃ³n (sin votar ni comentar) |

### 1.3 Casos de Uso Principales

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO / FALLERO                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â–º UC-001: Explorar fallas en mapa
         â”‚
         â”œâ”€â”€â–º UC-002: Buscar y filtrar fallas
         â”‚
         â”œâ”€â”€â–º UC-003: Ver detalle de falla
         â”‚
         â”œâ”€â”€â–º UC-004: Votar ninots (Ingenioso/CrÃ­tico/ArtÃ­stico)
         â”‚
         â”œâ”€â”€â–º UC-005: Consultar eventos de casales
         â”‚
         â”œâ”€â”€â–º UC-006: Marcar fallas como favoritas
         â”‚
         â”œâ”€â”€â–º UC-007: Comentar en fallas y ninots
         â”‚
         â”œâ”€â”€â–º UC-008: Gestionar perfil de usuario
         â”‚
         â””â”€â”€â–º UC-009: Recibir notificaciones de eventos
```

---

## 2. Funcionalidades

### 2.1 Feature: Mapa de Fallas

**DescripciÃ³n**: Mapa interactivo con todas las fallas geolocalizadas.

**Funcionalidades**:
- ğŸ—ºï¸ Mapa con marcadores de fallas
- ğŸ“ UbicaciÃ³n actual del usuario
- ğŸ” BÃºsqueda de fallas cercanas
- ğŸ“ Filtro por radio de distancia
- ğŸ·ï¸ Filtro por categorÃ­a/secciÃ³n
- ğŸ¯ Centrar en falla seleccionada

**Datos del marcador**:
```kotlin
data class FallaMarker(
    val id: Long,
    val nombre: String,
    val seccion: String,
    val latitud: Double,
    val longitud: Double,
    val categoria: Categoria,
    val distanciaKm: Double?,  // Calculada desde ubicaciÃ³n usuario
    val esFavorita: Boolean
)

enum class Categoria {
    ESPECIAL,
    PRIMERA_A,
    PRIMERA_B,
    SEGUNDA_A,
    SEGUNDA_B,
    TERCERA_A,
    TERCERA_B,
    CUARTA,
    QUINTA,
    INFANTIL_ESPECIAL,
    INFANTIL_PRIMERA,
    // ...
}
```

### 2.2 Feature: Listado y BÃºsqueda de Fallas

**DescripciÃ³n**: Lista paginada con bÃºsqueda y filtros avanzados.

**Funcionalidades**:
- ğŸ“‹ Lista con scroll infinito (paginaciÃ³n)
- ğŸ” BÃºsqueda por texto (nombre, descripciÃ³n)
- ğŸ·ï¸ Filtros: categorÃ­a, secciÃ³n, distancia
- â¬‡ï¸ OrdenaciÃ³n: nombre, distancia, valoraciÃ³n
- â­ PestaÃ±a de favoritos
- ğŸ”„ Pull-to-refresh

**Estados de UI**:
```kotlin
data class FallasListUiState(
    val fallas: List<FallaResumen> = emptyList(),
    val isLoading: Boolean = false,
    val isRefreshing: Boolean = false,
    val error: String? = null,
    val searchQuery: String = "",
    val selectedCategoria: Categoria? = null,
    val selectedSeccion: String? = null,
    val sortBy: SortOption = SortOption.NOMBRE,
    val showOnlyFavorites: Boolean = false,
    val currentPage: Int = 0,
    val hasMorePages: Boolean = true
)

enum class SortOption {
    NOMBRE,
    DISTANCIA,
    VALORACION,
    FECHA_FUNDACION
}

data class FallaResumen(
    val id: Long,
    val nombre: String,
    val seccion: String,
    val categoria: Categoria,
    val imagenUrl: String?,
    val distanciaKm: Double?,
    val totalEventos: Int,
    val esFavorita: Boolean
)
```

### 2.3 Feature: Detalle de Falla

**DescripciÃ³n**: Pantalla completa con toda la informaciÃ³n de una falla.

**Secciones**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Imagen/Boceto de la Falla]        â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Falla Convento JerusalÃ©n           â”‚
â”‚  SecciÃ³n 1A â€¢ Especial              â”‚
â”‚  â­ 4.8  â€¢  ğŸ“ 0.3 km               â”‚
â”‚  [â¤ï¸ Favorito]  [ğŸ“¤ Compartir]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ UBICACIÃ“N                       â”‚
â”‚  [Mini Mapa Interactivo]            â”‚
â”‚  [ğŸ“ CÃ³mo llegar]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â„¹ï¸ INFORMACIÃ“N                     â”‚
â”‚  Presidente: Juan MartÃ­nez          â”‚
â”‚  Fallera Mayor: MarÃ­a GarcÃ­a        â”‚
â”‚  Artista: Manolo MartÃ­n             â”‚
â”‚  AÃ±o fundaciÃ³n: 1942                â”‚
â”‚  Lema: "La Falla del Pueblo"        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ­ NINOTS (3)                      â”‚
â”‚  [Card Ninot 1] [Card Ninot 2] â†’    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… EVENTOS PRÃ“XIMOS (5)            â”‚
â”‚  â”œâ”€ ğŸ‰ PlantÃ  - 15 Mar              â”‚
â”‚  â”œâ”€ ğŸŒ¸ Ofrenda - 17 Mar             â”‚
â”‚  â””â”€ [Ver todos]                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¬ COMENTARIOS (12)                â”‚
â”‚  [Ãšltimos comentarios...]           â”‚
â”‚  [ğŸ’¬ AÃ±adir comentario]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Modelo de datos**:
```kotlin
data class FallaDetalle(
    val id: Long,
    val nombre: String,
    val seccion: String,
    val categoria: Categoria,
    val presidente: String?,
    val fallera: String?,
    val artista: String?,
    val anyoFundacion: Int?,
    val lema: String?,
    val descripcion: String?,
    val urlBoceto: String?,
    val webOficial: String?,
    val telefonoContacto: String?,
    val emailContacto: String?,
    val latitud: Double,
    val longitud: Double,
    val ninots: List<NinotResumen>,
    val eventosProximos: List<EventoResumen>,
    val totalComentarios: Int,
    val esFavorita: Boolean,
    val fechaCreacion: LocalDateTime,
    val fechaActualizacion: LocalDateTime
)
```

### 2.4 Feature: Ninots y VotaciÃ³n

**DescripciÃ³n**: Sistema de visualizaciÃ³n y votaciÃ³n de ninots.

**Tipos de voto**:
```kotlin
enum class TipoVoto {
    INGENIOSO,   // Creatividad e ingenio del mensaje
    CRITICO,     // CrÃ­tica social/polÃ­tica
    ARTISTICO    // Calidad artÃ­stica y tÃ©cnica
}

data class Voto(
    val ninotId: Long,
    val usuarioId: Long,
    val tipoVoto: TipoVoto,
    val fechaVoto: LocalDateTime
)
```

**Pantalla de Ninot**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  Ninots de Falla Convento        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    [Imagen del Ninot]       â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚    â—„  1/3  â–º               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  "El PolÃ­tico Corrupto"             â”‚
â”‚  Obra: La Trampa del Poder          â”‚
â”‚                                     â”‚
â”‚  ğŸ“ Altura: 3.5m â€¢ Ancho: 2.0m     â”‚
â”‚  ğŸ† Premiado: SÃ­                    â”‚
â”‚                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  VOTAR ESTE NINOT                   â”‚
â”‚                                     â”‚
â”‚  [ğŸ’¡ Ingenioso]  [ğŸ“¢ CrÃ­tico]      â”‚
â”‚        80            95             â”‚
â”‚                                     â”‚
â”‚  [ğŸ¨ ArtÃ­stico]                     â”‚
â”‚        70                           â”‚
â”‚                                     â”‚
â”‚  Total votos: 245                   â”‚
â”‚                                     â”‚
â”‚  âš ï¸ Ya has votado en esta categorÃ­aâ”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Reglas de votaciÃ³n**:
- âœ… Un voto por tipo por ninot
- âœ… Se puede votar en los 3 tipos
- âŒ No se puede votar dos veces el mismo tipo
- âŒ No se puede votar sin estar autenticado

### 2.5 Feature: Eventos

**DescripciÃ³n**: Calendario y listado de eventos de los casales.

**Tipos de eventos**:
```kotlin
enum class TipoEvento {
    PLANTA,          // PlantÃ 
    CREMA,           // CremÃ 
    OFRENDA,         // Ofrenda de flores
    DESFILE,         // Desfile/Pasacalle
    CENA,            // Cena de falla
    FIESTA,          // Fiesta/Verbena
    MASCLETÃ€,        // MascletÃ 
    CASTILLO,        // Castillo de fuegos
    PROCLAMACION,    // ProclamaciÃ³n
    EXALTACION,      // ExaltaciÃ³n
    OTRO             // Otros eventos
}

data class Evento(
    val id: Long,
    val fallaId: Long,
    val nombreFalla: String,
    val tipo: TipoEvento,
    val nombre: String,
    val descripcion: String?,
    val fechaEvento: LocalDateTime,
    val ubicacion: String?,
    val latitud: Double?,
    val longitud: Double?,
    val participantesEstimado: Int?,
    val imagenUrl: String?
)
```

**Vistas de eventos**:
- ğŸ“… **Calendario mensual**: Vista de calendario
- ğŸ“‹ **Lista cronolÃ³gica**: Ordenados por fecha
- ğŸ“ **Mapa de eventos**: Eventos prÃ³ximos en mapa
- â­ **Mis eventos**: Eventos de fallas favoritas

### 2.6 Feature: Perfil de Usuario

**DescripciÃ³n**: GestiÃ³n del perfil y preferencias.

**Secciones**:
```kotlin
data class UserProfile(
    val id: Long,
    val email: String,
    val nombreCompleto: String,
    val avatarUrl: String?,
    val rol: Rol,
    val fallaAsociada: FallaResumen?,  // Si pertenece a una falla
    val estadisticas: UserStats,
    val fechaRegistro: LocalDateTime
)

data class UserStats(
    val totalVotos: Int,
    val totalComentarios: Int,
    val totalFavoritas: Int,
    val eventosAsistidos: Int
)
```

**Pantalla de perfil**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mi Perfil                     [âš™ï¸] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚         [Avatar/Foto]               â”‚
â”‚       Juan PÃ©rez GarcÃ­a             â”‚
â”‚    juan.perez@email.com             â”‚
â”‚                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                     â”‚
â”‚  ğŸ›ï¸ MI FALLA                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Falla Convento JerusalÃ©n    â”‚   â”‚
â”‚  â”‚ SecciÃ³n 1A â€¢ Especial       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ğŸ“Š ESTADÃSTICAS                    â”‚
â”‚  â”œâ”€ ğŸ—³ï¸ Votos realizados: 45        â”‚
â”‚  â”œâ”€ ğŸ’¬ Comentarios: 12             â”‚
â”‚  â”œâ”€ â­ Fallas favoritas: 8         â”‚
â”‚  â””â”€ ğŸ“… Eventos asistidos: 3        â”‚
â”‚                                     â”‚
â”‚  âš™ï¸ AJUSTES                         â”‚
â”‚  â”œâ”€ ğŸ”” Notificaciones               â”‚
â”‚  â”œâ”€ ğŸŒ™ Tema oscuro                  â”‚
â”‚  â”œâ”€ ğŸ“ Permisos de ubicaciÃ³n        â”‚
â”‚  â””â”€ ğŸ” Cambiar contraseÃ±a           â”‚
â”‚                                     â”‚
â”‚  [ğŸšª Cerrar sesiÃ³n]                 â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.7 Feature: Favoritos

**DescripciÃ³n**: GestiÃ³n de fallas marcadas como favoritas.

```kotlin
// domain/usecase/ToggleFavoritoUseCase.kt
class ToggleFavoritoUseCase(
    private val favoritosRepository: FavoritosRepository
) {
    suspend operator fun invoke(fallaId: Long): Result<Boolean> {
        return favoritosRepository.toggleFavorito(fallaId)
        // Retorna true si ahora es favorita, false si se quitÃ³
    }
}

// SincronizaciÃ³n local-remota
interface FavoritosRepository {
    fun getFavoritos(): Flow<List<FallaResumen>>
    suspend fun toggleFavorito(fallaId: Long): Result<Boolean>
    suspend fun syncFavoritos(): Result<Unit>
}
```

### 2.8 Feature: Comentarios

**DescripciÃ³n**: Sistema de comentarios en fallas y ninots.

```kotlin
data class Comentario(
    val id: Long,
    val usuarioId: Long,
    val nombreUsuario: String,
    val avatarUrl: String?,
    val contenido: String,
    val fechaCreacion: LocalDateTime,
    val editado: Boolean,
    val respuestaA: Long?,  // ID del comentario padre
    val respuestas: List<Comentario>
)

// Crear comentario
data class CrearComentarioRequest(
    val contenido: String,
    val fallaId: Long? = null,
    val ninotId: Long? = null,
    val respuestaA: Long? = null
)
```

---

## 3. Arquitectura de Features

### 3.1 Estructura de Paquetes

```
com.fallapp.user/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ ApiConfig.kt
â”‚   â”‚   â””â”€â”€ MapConfig.kt
â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”œâ”€â”€ AppModule.kt
â”‚   â”‚   â”œâ”€â”€ NetworkModule.kt
â”‚   â”‚   â””â”€â”€ DatabaseModule.kt
â”‚   â”œâ”€â”€ network/
â”‚   â”‚   â”œâ”€â”€ KtorClient.kt
â”‚   â”‚   â”œâ”€â”€ AuthInterceptor.kt
â”‚   â”‚   â””â”€â”€ NetworkMonitor.kt
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ FallAppDatabase.kt
â”‚   â”‚   â””â”€â”€ Converters.kt
â”‚   â””â”€â”€ util/
â”‚       â”œâ”€â”€ Result.kt
â”‚       â”œâ”€â”€ DateTimeUtils.kt
â”‚       â””â”€â”€ LocationUtils.kt
â”‚
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthApiService.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ LoginRequestDto.kt
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ LoginResponseDto.kt
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterRequestDto.kt
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ UserDto.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TokenManager.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserPreferences.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthMapper.kt
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ AuthRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ User.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthToken.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Rol.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ LogoutUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ GetCurrentUserUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ login/
â”‚   â”‚       â”‚   â”œâ”€â”€ LoginScreen.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ LoginViewModel.kt
â”‚   â”‚       â”‚   â””â”€â”€ LoginUiState.kt
â”‚   â”‚       â””â”€â”€ register/
â”‚   â”‚           â”œâ”€â”€ RegisterScreen.kt
â”‚   â”‚           â””â”€â”€ RegisterViewModel.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ fallas/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaApiService.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ FallaResponseDto.kt
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ FallaDetalleDto.kt
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ PaginatedResponseDto.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaDao.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaEntity.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FavoritoEntity.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FallaMapper.kt
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ FallaRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Falla.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaDetalle.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaResumen.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FallaMarker.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Categoria.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FallaRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ GetFallasUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ GetFallaByIdUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ SearchFallasUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ GetFallasCercanasUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ GetFallasParaMapaUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ list/
â”‚   â”‚       â”‚   â”œâ”€â”€ FallasListScreen.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ FallasListViewModel.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ FallasListUiState.kt
â”‚   â”‚       â”‚   â””â”€â”€ components/
â”‚   â”‚       â”‚       â”œâ”€â”€ FallaCard.kt
â”‚   â”‚       â”‚       â”œâ”€â”€ SearchBar.kt
â”‚   â”‚       â”‚       â””â”€â”€ FilterChips.kt
â”‚   â”‚       â”œâ”€â”€ detail/
â”‚   â”‚       â”‚   â”œâ”€â”€ FallaDetailScreen.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ FallaDetailViewModel.kt
â”‚   â”‚       â”‚   â””â”€â”€ components/
â”‚   â”‚       â”‚       â”œâ”€â”€ FallaHeader.kt
â”‚   â”‚       â”‚       â”œâ”€â”€ FallaInfoSection.kt
â”‚   â”‚       â”‚       â””â”€â”€ FallaMiniMap.kt
â”‚   â”‚       â””â”€â”€ map/
â”‚   â”‚           â”œâ”€â”€ FallasMapScreen.kt
â”‚   â”‚           â”œâ”€â”€ FallasMapViewModel.kt
â”‚   â”‚           â””â”€â”€ components/
â”‚   â”‚               â”œâ”€â”€ FallaMarkerContent.kt
â”‚   â”‚               â””â”€â”€ MapControls.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ eventos/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EventoApiService.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EventoDao.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EventoEntity.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EventoMapper.kt
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ EventoRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Evento.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TipoEvento.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EventoRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ GetEventosFuturosUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ GetEventosByFallaUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ GetEventosProximosUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ list/
â”‚   â”‚       â”‚   â”œâ”€â”€ EventosListScreen.kt
â”‚   â”‚       â”‚   â””â”€â”€ EventosListViewModel.kt
â”‚   â”‚       â”œâ”€â”€ calendar/
â”‚   â”‚       â”‚   â”œâ”€â”€ EventosCalendarScreen.kt
â”‚   â”‚       â”‚   â””â”€â”€ EventosCalendarViewModel.kt
â”‚   â”‚       â””â”€â”€ detail/
â”‚   â”‚           â””â”€â”€ EventoDetailScreen.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ ninots/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NinotApiService.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ VotoApiService.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NinotDao.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NinotEntity.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ VotoLocalEntity.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NinotMapper.kt
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â”œâ”€â”€ NinotRepositoryImpl.kt
â”‚   â”‚   â”‚       â””â”€â”€ VotoRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Ninot.kt
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Voto.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TipoVoto.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NinotRepository.kt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ VotoRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ GetNinotsUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ GetNinotsByFallaUseCase.kt
â”‚   â”‚   â”‚       â”œâ”€â”€ VotarNinotUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ GetMisVotosUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ list/
â”‚   â”‚       â”‚   â”œâ”€â”€ NinotsListScreen.kt
â”‚   â”‚       â”‚   â””â”€â”€ NinotsListViewModel.kt
â”‚   â”‚       â””â”€â”€ detail/
â”‚   â”‚           â”œâ”€â”€ NinotDetailScreen.kt
â”‚   â”‚           â”œâ”€â”€ NinotDetailViewModel.kt
â”‚   â”‚           â””â”€â”€ components/
â”‚   â”‚               â”œâ”€â”€ NinotImageGallery.kt
â”‚   â”‚               â””â”€â”€ VotingSection.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ favoritos/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FavoritoDao.kt
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ FavoritosRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FavoritosRepository.kt
â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚       â”œâ”€â”€ GetFavoritosUseCase.kt
â”‚   â”‚   â”‚       â””â”€â”€ ToggleFavoritoUseCase.kt
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ FavoritosScreen.kt
â”‚   â”‚       â””â”€â”€ FavoritosViewModel.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ comentarios/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚
â”‚   â””â”€â”€ profile/
â”‚       â”œâ”€â”€ data/
â”‚       â”‚   â”œâ”€â”€ remote/
â”‚       â”‚   â”‚   â””â”€â”€ ProfileApiService.kt
â”‚       â”‚   â””â”€â”€ repository/
â”‚       â”‚       â””â”€â”€ ProfileRepositoryImpl.kt
â”‚       â”œâ”€â”€ domain/
â”‚       â”‚   â”œâ”€â”€ model/
â”‚       â”‚   â”‚   â””â”€â”€ UserProfile.kt
â”‚       â”‚   â”œâ”€â”€ repository/
â”‚       â”‚   â”‚   â””â”€â”€ ProfileRepository.kt
â”‚       â”‚   â””â”€â”€ usecase/
â”‚       â”‚       â”œâ”€â”€ GetProfileUseCase.kt
â”‚       â”‚       â””â”€â”€ UpdateProfileUseCase.kt
â”‚       â””â”€â”€ presentation/
â”‚           â”œâ”€â”€ ProfileScreen.kt
â”‚           â”œâ”€â”€ ProfileViewModel.kt
â”‚           â””â”€â”€ settings/
â”‚               â””â”€â”€ SettingsScreen.kt
â”‚
â”œâ”€â”€ navigation/
â”‚   â”œâ”€â”€ NavGraph.kt
â”‚   â”œâ”€â”€ Routes.kt
â”‚   â””â”€â”€ BottomNavigation.kt
â”‚
â””â”€â”€ ui/
    â”œâ”€â”€ theme/
    â”‚   â”œâ”€â”€ Color.kt
    â”‚   â”œâ”€â”€ Type.kt
    â”‚   â””â”€â”€ Theme.kt
    â””â”€â”€ components/
        â”œâ”€â”€ LoadingIndicator.kt
        â”œâ”€â”€ ErrorMessage.kt
        â”œâ”€â”€ EmptyState.kt
        â””â”€â”€ PullToRefresh.kt
```

---

## 4. Pantallas y NavegaciÃ³n

### 4.1 Mapa de NavegaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SPLASH SCREEN                                â”‚
â”‚                    (Verificar autenticaciÃ³n)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                           â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   LOGIN     â”‚             â”‚   MAIN SCREEN   â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚  (Bottom Nav)   â”‚
                  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                             â”‚
                  â–¼                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â–¼        â–¼        â–¼        â–¼
           â”‚  REGISTER   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ MAP  â”‚ â”‚FALLASâ”‚ â”‚EVENTSâ”‚ â”‚PERFILâ”‚
                                   â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚        â”‚        â”‚
                                      â–¼        â–¼        â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚     FALLA DETAIL           â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼         â–¼         â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚NINOTS â”‚ â”‚EVENTOSâ”‚ â”‚COMENTARIOSâ”‚
                         â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ NINOT     â”‚
                       â”‚ DETAIL    â”‚
                       â”‚ + VOTAR   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Bottom Navigation

```kotlin
// navigation/BottomNavigation.kt
enum class BottomNavItem(
    val route: String,
    val icon: ImageVector,
    val label: String
) {
    MAP(Routes.Map.route, Icons.Default.Map, "Mapa"),
    FALLAS(Routes.FallasList.route, Icons.Default.Festival, "Fallas"),
    EVENTS(Routes.EventsList.route, Icons.Default.Event, "Eventos"),
    PROFILE(Routes.Profile.route, Icons.Default.Person, "Perfil")
}
```

### 4.3 DefiniciÃ³n de Rutas

```kotlin
// navigation/Routes.kt
sealed class Routes(val route: String) {
    // Auth
    data object Splash : Routes("splash")
    data object Login : Routes("login")
    data object Register : Routes("register")
    
    // Main tabs
    data object Map : Routes("map")
    data object FallasList : Routes("fallas")
    data object EventsList : Routes("eventos")
    data object Profile : Routes("profile")
    
    // Detail screens
    data object FallaDetail : Routes("fallas/{fallaId}") {
        fun createRoute(fallaId: Long) = "fallas/$fallaId"
    }
    data object EventoDetail : Routes("eventos/{eventoId}") {
        fun createRoute(eventoId: Long) = "eventos/$eventoId"
    }
    data object NinotDetail : Routes("ninots/{ninotId}") {
        fun createRoute(ninotId: Long) = "ninots/$ninotId"
    }
    
    // Nested screens
    data object NinotsByFalla : Routes("fallas/{fallaId}/ninots") {
        fun createRoute(fallaId: Long) = "fallas/$fallaId/ninots"
    }
    data object EventosByFalla : Routes("fallas/{fallaId}/eventos") {
        fun createRoute(fallaId: Long) = "fallas/$fallaId/eventos"
    }
    
    // Settings
    data object Settings : Routes("settings")
    data object EditProfile : Routes("profile/edit")
    data object Favoritos : Routes("favoritos")
}
```

---

## 5. Modelos de Dominio

### 5.1 Modelo: Falla

```kotlin
// domain/model/Falla.kt
package com.fallapp.user.features.fallas.domain.model

data class Falla(
    val id: Long,
    val nombre: String,
    val seccion: String,
    val categoria: Categoria,
    val presidente: String?,
    val fallera: String?,
    val artista: String?,
    val anyoFundacion: Int?,
    val lema: String?,
    val descripcion: String?,
    val urlBoceto: String?,
    val webOficial: String?,
    val telefonoContacto: String?,
    val emailContacto: String?,
    val latitud: Double,
    val longitud: Double,
    val distintivo: String?,
    val experim: Boolean,
    val totalEventos: Int,
    val totalNinots: Int,
    val totalMiembros: Int,
    val fechaCreacion: LocalDateTime,
    val fechaActualizacion: LocalDateTime
)

enum class Categoria(val displayName: String) {
    ESPECIAL("Especial"),
    PRIMERA_A("Primera A"),
    PRIMERA_B("Primera B"),
    SEGUNDA_A("Segunda A"),
    SEGUNDA_B("Segunda B"),
    TERCERA_A("Tercera A"),
    TERCERA_B("Tercera B"),
    CUARTA("Cuarta"),
    QUINTA("Quinta"),
    INFANTIL_ESPECIAL("Infantil Especial"),
    INFANTIL_PRIMERA("Infantil Primera");
    
    companion object {
        fun fromString(value: String): Categoria? {
            return entries.find { it.name.equals(value, ignoreCase = true) }
        }
    }
}
```

### 5.2 Modelo: Ninot

```kotlin
// domain/model/Ninot.kt
package com.fallapp.user.features.ninots.domain.model

data class Ninot(
    val id: Long,
    val fallaId: Long,
    val nombreFalla: String,
    val nombreNinot: String,
    val tituloObra: String?,
    val descripcion: String?,
    val altura: Double?,
    val ancho: Double?,
    val imagenes: List<String>,
    val premiado: Boolean,
    val totalVotos: Int,
    val votosIngenioso: Int,
    val votosCritico: Int,
    val votosArtistico: Int,
    val misVotos: List<TipoVoto>,  // Votos del usuario actual
    val fechaCreacion: LocalDateTime
)

enum class TipoVoto(val displayName: String, val emoji: String) {
    INGENIOSO("Ingenioso", "ğŸ’¡"),
    CRITICO("CrÃ­tico", "ğŸ“¢"),
    ARTISTICO("ArtÃ­stico", "ğŸ¨")
}
```

### 5.3 Modelo: Evento

```kotlin
// domain/model/Evento.kt
package com.fallapp.user.features.eventos.domain.model

data class Evento(
    val id: Long,
    val fallaId: Long,
    val nombreFalla: String,
    val tipo: TipoEvento,
    val nombre: String,
    val descripcion: String?,
    val fechaEvento: LocalDateTime,
    val ubicacion: String?,
    val latitud: Double?,
    val longitud: Double?,
    val participantesEstimado: Int?,
    val imagenUrl: String?
)

enum class TipoEvento(val displayName: String, val emoji: String) {
    PLANTA("PlantÃ ", "ğŸ—ï¸"),
    CREMA("CremÃ ", "ğŸ”¥"),
    OFRENDA("Ofrenda", "ğŸŒ¸"),
    DESFILE("Desfile", "ğŸ­"),
    CENA("Cena", "ğŸ½ï¸"),
    FIESTA("Fiesta", "ğŸ‰"),
    MASCLETA("MascletÃ ", "ğŸ’¥"),
    CASTILLO("Castillo", "ğŸ†"),
    PROCLAMACION("ProclamaciÃ³n", "ğŸ‘‘"),
    EXALTACION("ExaltaciÃ³n", "ğŸŒŸ"),
    OTRO("Otro", "ğŸ“…")
}
```

---

## 6. API Endpoints Utilizados

### 6.1 Endpoints PÃºblicos (Sin Auth)

| MÃ©todo | Endpoint | UseCase |
|--------|----------|---------|
| GET | `/api/fallas` | `GetFallasUseCase` |
| GET | `/api/fallas/{id}` | `GetFallaByIdUseCase` |
| GET | `/api/fallas/buscar` | `SearchFallasUseCase` |
| GET | `/api/fallas/cercanas` | `GetFallasCercanasUseCase` |
| GET | `/api/fallas/seccion/{seccion}` | `GetFallasBySeccionUseCase` |
| GET | `/api/fallas/categoria/{cat}` | `GetFallasByCategoriaUseCase` |
| GET | `/api/eventos/futuros` | `GetEventosFuturosUseCase` |
| GET | `/api/eventos/proximos` | `GetEventosProximosUseCase` |
| GET | `/api/eventos/{id}` | `GetEventoByIdUseCase` |
| GET | `/api/eventos/falla/{fallaId}` | `GetEventosByFallaUseCase` |
| GET | `/api/ninots` | `GetNinotsUseCase` |
| GET | `/api/ninots/{id}` | `GetNinotByIdUseCase` |
| GET | `/api/ninots/falla/{fallaId}` | `GetNinotsByFallaUseCase` |
| GET | `/api/ninots/premiados` | `GetNinotsPremiadosUseCase` |
| GET | `/api/comentarios` | `GetComentariosUseCase` |

### 6.2 Endpoints Autenticados

| MÃ©todo | Endpoint | UseCase |
|--------|----------|---------|
| POST | `/api/auth/login` | `LoginUseCase` |
| POST | `/api/auth/registro` | `RegisterUseCase` |
| POST | `/api/votos` | `VotarNinotUseCase` |
| GET | `/api/votos/mis-votos` | `GetMisVotosUseCase` |
| POST | `/api/comentarios` | `CrearComentarioUseCase` |
| PUT | `/api/comentarios/{id}` | `EditarComentarioUseCase` |
| DELETE | `/api/comentarios/{id}` | `EliminarComentarioUseCase` |
| GET | `/api/usuarios/perfil` | `GetProfileUseCase` |
| PUT | `/api/usuarios/perfil` | `UpdateProfileUseCase` |

---

## 7. Estrategia Offline-First

### 7.1 Principios

1. **Mostrar datos locales primero** - El usuario ve datos inmediatamente
2. **Sincronizar en background** - Actualizar sin bloquear UI
3. **Cachear inteligentemente** - TTL por tipo de datos
4. **Indicar estado de sincronizaciÃ³n** - Usuario sabe si datos son frescos

### 7.2 ImplementaciÃ³n de Repository

```kotlin
// features/fallas/data/repository/FallaRepositoryImpl.kt
class FallaRepositoryImpl(
    private val remoteDataSource: FallaRemoteDataSource,
    private val localDataSource: FallaLocalDataSource,
    private val mapper: FallaMapper,
    private val networkMonitor: NetworkMonitor
) : FallaRepository {

    override fun getFallas(
        page: Int,
        size: Int,
        forceRefresh: Boolean
    ): Flow<Result<List<Falla>>> = flow {
        
        emit(Result.Loading)
        
        // 1. Emitir datos locales inmediatamente (si existen)
        val localData = localDataSource.getFallas(page, size)
        if (localData.isNotEmpty()) {
            emit(Result.Success(localData.map { mapper.entityToDomain(it) }))
        }
        
        // 2. Si hay conexiÃ³n y datos son viejos (o forceRefresh), actualizar
        if (networkMonitor.isConnected && (forceRefresh || shouldRefresh(page))) {
            try {
                val remoteData = remoteDataSource.getFallas(page, size)
                
                // 3. Guardar en cachÃ© local
                localDataSource.insertFallas(remoteData.map { mapper.dtoToEntity(it) })
                localDataSource.updateLastSync(page)
                
                // 4. Emitir datos frescos
                emit(Result.Success(remoteData.map { mapper.dtoToDomain(it) }))
            } catch (e: Exception) {
                // Si ya emitimos datos locales, no emitir error
                if (localData.isEmpty()) {
                    emit(Result.Error(e, "Error al cargar fallas"))
                }
            }
        }
    }.flowOn(Dispatchers.IO)
    
    private suspend fun shouldRefresh(page: Int): Boolean {
        val lastSync = localDataSource.getLastSync(page)
        val now = System.currentTimeMillis()
        val cacheValidityMs = 15 * 60 * 1000 // 15 minutos
        return lastSync == null || (now - lastSync) > cacheValidityMs
    }
}
```

### 7.3 Entidades Room

```kotlin
// features/fallas/data/local/FallaEntity.kt
@Entity(tableName = "fallas")
data class FallaEntity(
    @PrimaryKey
    val id: Long,
    val nombre: String,
    val seccion: String,
    val categoria: String,
    val presidente: String?,
    val fallera: String?,
    val artista: String?,
    val anyoFundacion: Int?,
    val lema: String?,
    val descripcion: String?,
    val urlBoceto: String?,
    val latitud: Double,
    val longitud: Double,
    val totalEventos: Int,
    val totalNinots: Int,
    @ColumnInfo(name = "last_updated")
    val lastUpdated: Long = System.currentTimeMillis()
)

// features/fallas/data/local/FallaDao.kt
@Dao
interface FallaDao {
    @Query("SELECT * FROM fallas ORDER BY nombre ASC LIMIT :size OFFSET :offset")
    suspend fun getFallas(size: Int, offset: Int): List<FallaEntity>
    
    @Query("SELECT * FROM fallas WHERE id = :id")
    suspend fun getFallaById(id: Long): FallaEntity?
    
    @Query("SELECT * FROM fallas WHERE nombre LIKE '%' || :query || '%' OR descripcion LIKE '%' || :query || '%'")
    suspend fun searchFallas(query: String): List<FallaEntity>
    
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertFallas(fallas: List<FallaEntity>)
    
    @Query("DELETE FROM fallas")
    suspend fun deleteAll()
    
    @Query("SELECT * FROM fallas WHERE id IN (SELECT falla_id FROM favoritos)")
    fun getFavoritas(): Flow<List<FallaEntity>>
}
```

---

## 8. Mapas y GeolocalizaciÃ³n

### 8.1 ConfiguraciÃ³n de Google Maps

```kotlin
// core/config/MapConfig.kt
object MapConfig {
    // Coordenadas de Valencia (centro por defecto)
    const val DEFAULT_LAT = 39.4699
    const val DEFAULT_LNG = -0.3763
    const val DEFAULT_ZOOM = 14f
    
    // LÃ­mites del Ã¡rea de Valencia
    const val MIN_LAT = 39.40
    const val MAX_LAT = 39.52
    const val MIN_LNG = -0.45
    const val MAX_LNG = -0.30
    
    // Zoom levels
    const val MIN_ZOOM = 10f
    const val MAX_ZOOM = 20f
    const val DETAIL_ZOOM = 17f
}
```

### 8.2 Pantalla de Mapa

```kotlin
// features/fallas/presentation/map/FallasMapScreen.kt
@Composable
fun FallasMapScreen(
    viewModel: FallasMapViewModel = koinViewModel(),
    onFallaClick: (Long) -> Unit
) {
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()
    val cameraPositionState = rememberCameraPositionState {
        position = CameraPosition.fromLatLngZoom(
            LatLng(MapConfig.DEFAULT_LAT, MapConfig.DEFAULT_LNG),
            MapConfig.DEFAULT_ZOOM
        )
    }
    
    GoogleMap(
        modifier = Modifier.fillMaxSize(),
        cameraPositionState = cameraPositionState,
        properties = MapProperties(
            isMyLocationEnabled = uiState.locationPermissionGranted,
            mapType = MapType.NORMAL
        ),
        uiSettings = MapUiSettings(
            zoomControlsEnabled = true,
            myLocationButtonEnabled = true
        )
    ) {
        // Marcadores de fallas
        uiState.fallas.forEach { falla ->
            Marker(
                state = MarkerState(
                    position = LatLng(falla.latitud, falla.longitud)
                ),
                title = falla.nombre,
                snippet = "${falla.seccion} â€¢ ${falla.categoria.displayName}",
                onClick = {
                    onFallaClick(falla.id)
                    true
                }
            )
        }
        
        // CÃ­rculo de radio de bÃºsqueda
        uiState.searchRadius?.let { radius ->
            uiState.userLocation?.let { location ->
                Circle(
                    center = LatLng(location.latitude, location.longitude),
                    radius = radius * 1000, // km a metros
                    strokeColor = Color.Blue.copy(alpha = 0.5f),
                    fillColor = Color.Blue.copy(alpha = 0.1f)
                )
            }
        }
    }
    
    // FAB para filtros
    FloatingActionButton(
        onClick = { viewModel.onEvent(MapEvent.ShowFilters) },
        modifier = Modifier
            .align(Alignment.BottomEnd)
            .padding(16.dp)
    ) {
        Icon(Icons.Default.FilterList, "Filtros")
    }
}
```

### 8.3 Permisos de UbicaciÃ³n

```kotlin
// core/util/LocationUtils.kt
@Composable
fun RequestLocationPermission(
    onPermissionGranted: () -> Unit,
    onPermissionDenied: () -> Unit
) {
    val permissionState = rememberMultiplePermissionsState(
        listOf(
            Manifest.permission.ACCESS_FINE_LOCATION,
            Manifest.permission.ACCESS_COARSE_LOCATION
        )
    )
    
    LaunchedEffect(permissionState.allPermissionsGranted) {
        if (permissionState.allPermissionsGranted) {
            onPermissionGranted()
        }
    }
    
    if (!permissionState.allPermissionsGranted) {
        if (permissionState.shouldShowRationale) {
            // Mostrar diÃ¡logo explicativo
            AlertDialog(
                onDismissRequest = { },
                title = { Text("Permiso de ubicaciÃ³n") },
                text = { 
                    Text("La ubicaciÃ³n es necesaria para mostrar fallas cercanas y tu posiciÃ³n en el mapa.") 
                },
                confirmButton = {
                    TextButton(onClick = { permissionState.launchMultiplePermissionRequest() }) {
                        Text("Conceder")
                    }
                },
                dismissButton = {
                    TextButton(onClick = onPermissionDenied) {
                        Text("Cancelar")
                    }
                }
            )
        } else {
            LaunchedEffect(Unit) {
                permissionState.launchMultiplePermissionRequest()
            }
        }
    }
}
```

---

## ğŸ“š Documentos Relacionados

- [00.ARQUITECTURA-MOBILE.md](00.ARQUITECTURA-MOBILE.md) - Arquitectura general
- [01.APP-ADMIN-SPEC.md](01.APP-ADMIN-SPEC.md) - EspecificaciÃ³n app admin
- [03.PROMPT-GENERACION-IA.md](03.PROMPT-GENERACION-IA.md) - Prompts para IA
- [../../GUIA.API.FRONTEND.md](../../GUIA.API.FRONTEND.md) - DocumentaciÃ³n API

---

> **Estado de implementaciÃ³n**: ğŸ”„ Pendiente de desarrollo
> **Prioridad**: CrÃ­tica (aplicaciÃ³n principal para usuarios)
